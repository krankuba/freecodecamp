<!doctype html>
<html>
<head>
  <title>Show The Local Weather</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,900|Roboto' rel='stylesheet' type='text/css'>
  <style>
      #icon {
           width: 80px;
           margin-left: 20px;
      }
      .container {
           font-family: 'Roboto', sans-serif;
           margin-top: 100px;
           margin-bottom: 100px;
      }
      .m-top {
           margin-top: 20px;
      }
      .m-bot {
           margin-bottom: 20px;
      }
      .btn {
           margin-bottom: 9px;
      }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script>
    function getLocation() {
        var defer = jQuery.Deferred();
        var api  = 'http://freegeoip.net/json/?callback=?';
        $.getJSON(api, function(r) {
            defer.resolve(r);
            $('#location').html(r.city + ", " + r.country_name);
        });
        return defer.promise();
    }
    function getWeather(r) {
        var api = 'http://api.openweathermap.org/data/2.5/weather?q=' + r.city + '&APPID=80a656b7318869c55b6bcb8a93f5e403';
        $.getJSON(api, function(r) {
            var mainWeather = r.weather[0].main;
            var mainWeatherDescription = r.weather[0].description;
            var iconUrl = 'http://openweathermap.org/img/w/' + r.weather[0].icon +'.png';
            var temp = r.main.temp;
            var tempF = Math.round((temp * 9/5) - 459.67);
            var tempC = Math.round(temp - 273.15);
            var humidity = r.main.humidity;
            $('#icon').attr("src",iconUrl);
            $('#weather1').html(tempC +"\xB0");
            $('#weather2').html(mainWeatherDescription);
            $('#weather3').html(humidity + " % humidity");
            $('.btn').html('C');
            $('.btn').on("click", function() {
                if ($('.btn').is(":contains('C')")) {
                    $('#weather1').html(tempF +"\xB0");
                    $('.btn').html('F');
                } else {
                    $('.btn').html('C');
                    $('#weather1').html(tempC +"\xB0");
            }
          });
        });
      }
    $(document).ready(function() {
        getLocation().then(function(r){
            getWeather(r);
        });
    });

  </script>
</head>

<body>
<div class="container" align=center>
  <div class="col-sm-4 col-sm-offset-4 well">
    <h3 class="m-bot" id="location">Location, Country</h3>
    <div row row-content>
      <div class="media">
        <div class="media-left">
          <img class="media-object m-top" id="icon" alt="icon">
        </div>
        <div class="media-body">
          <h1 class="media-heading m-bot">
          <span id="weather1"><strong>temp</strong></span>
          <span><a class='btn btn-default'></a></span></h1>
          <h3 class="m-bot" id="weather2">details</h3>
          <p class="m-bot" id="weather3">wind+hum</p>
        </div>
      </div>
    </div>
  </div>
</div>
</body>

</html>
